![BankingNLP Team with AI Owl Chatbot](../docs/img/logo_Banking_NLP.png)

<p align="center"><b>Современная команда с поддержкой ИИ: чат-бот-сова, облако искусственного интеллекта, офис и бренд Совкомбанка</b></p>

# Banking NLP — промышленная система для банковского сектора

## Бизнес-требования

### Цель
Создание интеллектуальной системы для автоматического выделения тематик и продуктовых упоминаний из транскрибированных разговоров с клиентами с целью повышения качества обслуживания, конверсии продаж и оптимизации продуктовой линейки.

### Ключевые функциональные требования

1. **Автоматическое распознавание не менее 50 тематик, включая:**
   - Финансовые продукты и услуги (кредиты, вклады, инвестиции, страхование и т.д.)
   - Проблемные ситуации (технические сбои, претензии, вопросы безопасности)
   - Жизненные события клиентов (свадьба, рождение ребенка, покупка жилья)
   - Конкурентные предложения (упоминания других банков и их продуктов)

2. **Анализ продуктовых упоминаний:**
   - Идентификация продуктов банка в разговоре
   - Определение контекста упоминания (интерес, отказ, сравнение)
   - Выявление причин отказа от продуктов

3. **Автоматическая классификация эмоционального окраса обсуждения каждой тематики и продукта**

4. **Формирование инсайтов:**
   - Выявление наиболее востребованных продуктов
   - Определение болевых точек в обслуживании
   - Идентификация незакрытых потребностей клиентов

### Технические требования

1. **Производительность системы:**
   - Обработка не менее 10,000 транскриптов ежедневно
   - Время анализа одного разговора – не более 2 минут
   - Точность определения тематик не менее 85%

2. **Интеграционные возможности:**
   - API для подключения к CRM-системе банка
   - Интеграция с системой транскрибирования звонков

### Ожидаемые бизнес-результаты

- Увеличение конверсии продаж на 15-20% за счет выявления скрытых потребностей
- Снижение оттока клиентов на 10% благодаря раннему выявлению проблемных ситуаций
- Оптимизация продуктовой линейки на основе реальных потребностей клиентов

## Модули и структура проекта

| Модуль                | Назначение                                                                                  | Краткое описание для неспециалистов                                                                                 |
|-----------------------|--------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|
| **app/**              | Основное приложение и бизнес-логика                                                        | Сердце системы: отвечает за обработку запросов, анализ текстов, работу с пользователями и интеграцию с другими частями проекта. |
| **app/api/**          | Внешний интерфейс (API)                                                                    | Позволяет другим программам и сервисам обращаться к системе для анализа текстов, получения отчетов и управления.     |
| **app/services/**     | Бизнес-логика и интеграция                                                                 | Здесь происходит основной "умный" анализ: обработка текстов, вызов малой LLM, формирование аналитики и алертов.     |
| **app/schemas/**      | Проверка и описание данных                                                                 | Определяет, как должны выглядеть входящие и исходящие данные, чтобы система работала стабильно и безопасно.         |
| **app/core/**         | Настройки, база данных, безопасность                                                       | Хранит параметры работы системы, отвечает за подключение к базе данных и защиту от несанкционированного доступа.    |
| **app/models/**       | Описание структуры данных                                                                  | Описывает, как информация хранится в базе данных: пользователи, разговоры, отчеты и т.д.                           |
| **app/utils/**        | Вспомогательные инструменты                                                                | Помогают с обработкой файлов, логированием и другими техническими задачами.                                         |
| **frontend/**         | Веб-интерфейс                                                                              | Удобные формы и дашборды для операторов и аналитиков, чтобы видеть результаты анализа и отчеты.                     |
| **src/**              | Ядро обработки текстов и машинного обучения                                                | Здесь происходит подготовка данных, обучение и запуск моделей для анализа текстов.                                   |
| **configs/**          | Конфигурационные файлы                                                                     | Хранят параметры для моделей, логирования, работы малой LLM и другие настройки.                                     |
| **data/**             | Данные проекта                                                                             | Сырые и обработанные данные для обучения и тестирования моделей.                                                    |
| **models/**           | Сохранённые модели                                                                         | Файлы с обученными моделями, которые используются для анализа новых текстов.                                        |
| **nginx/**            | Проксирование и отдача статики                                                             | Обеспечивает быстрый и безопасный доступ к веб-интерфейсу и API.                                                    |
| **infrastructure/**   | Docker, Kubernetes, CI/CD                                                                  | Автоматизация запуска, обновления и масштабирования системы.                                                        |
| **notebooks/**        | Jupyter-блокноты                                                                           | Файлы для экспериментов и анализа данных в удобном формате.                                                         |
| **tests/**            | Тесты                                                                                      | Проверяют, что все части системы работают правильно и без ошибок.                                                   |
| **scripts/**          | Вспомогательные скрипты                                                                    | Автоматизируют рутинные задачи: миграции базы, загрузку данных, деплой моделей.                                     |
| **docs/**             | Документация и диаграммы                                                                   | Описывает, как работает система, и содержит схемы для наглядности.                                                  |
| **reports/**          | Отчёты и графики                                                                           | Визуализация результатов анализа для руководства и аналитиков.                                                      |
| **logs/**             | Логи работы системы                                                                        | Хранят все важные события, ошибки и действия пользователей для аудита и мониторинга.                                |

### Положительные стороны структуры

- Современная модульная архитектура с четким разделением ответственности
- Поддержка Docker и Kubernetes
- Централизованная система логирования
- Интеграция с малой LLM
- Версионированное API с JWT-аутентификацией

## Описание компонентов системы (простым языком)

| Компонент                | Описание                                                                                                   | Для чего нужен и как работает                                                                                      |
|--------------------------|------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
| **FastAPI Backend**      | Главный сервер системы                                                                                     | Принимает запросы, управляет анализом текстов, хранит и отдаёт результаты, обеспечивает безопасность.              |
| **NLP Service**          | Анализ текстов и разговоров                                                                                | "Понимает" смысл текста, определяет тему, эмоцию, продукты и уровень удовлетворённости клиента.                    |
| **LLM Service (малая LLM)** | Умная языковая модель (например, Phi-2)                                                                  | Быстро и локально определяет тематику и смысл текста, не обращаясь к внешним сервисам, работает даже без интернета. |
| **Analytics Service**    | Бизнес-аналитика                                                                                           | Считает статистику, строит отчёты и графики по темам, продуктам, эмоциям и другим важным показателям.              |
| **Monitoring Service**   | Мониторинг и алерты                                                                                        | Следит за качеством работы системы, вовремя сообщает о сбоях, ошибках или подозрительных событиях.                  |
| **Integration Service**  | Интеграция с другими системами                                                                             | Передаёт результаты анализа в CRM, хранилища данных и другие банковские сервисы.                                   |
| **Security**             | Безопасность и контроль доступа                                                                            | Защищает систему от несанкционированного доступа, управляет ролями пользователей и ограничивает частоту запросов.   |
| **Frontend**             | Веб-интерфейс для пользователей                                                                            | Позволяет операторам и аналитикам удобно работать с системой через браузер: запускать анализ, смотреть отчёты.     |
| **PostgreSQL**           | База данных                                                                                               | Надёжно хранит все разговоры, результаты анализа, отчёты, пользователей и логи.                                    |
| **Kafka**                | Очередь событий                                                                                            | Помогает обрабатывать большие объёмы данных и связывать разные части системы между собой.                          |
| **Prometheus & Grafana** | Мониторинг и визуализация                                                                                  | Системы для сбора и красивого отображения метрик работы и состояния системы.                                       |
| **Alerting System**      | Система оповещений                                                                                         | Автоматически уведомляет ответственных сотрудников о важных событиях и проблемах.                                   |
| **Docker/Kubernetes**    | Контейнеризация и управление инфраструктурой                                                               | Позволяет запускать и обновлять систему быстро, надёжно и на разных серверах или в облаке.                         |
| **CI/CD Pipeline**       | Автоматизация тестирования и обновлений                                                                    | Проверяет, что новые версии системы работают правильно, и автоматически выкатывает их в работу.                    |
| **Логирование**          | Запись всех событий и ошибок                                                                               | Сохраняет информацию о работе системы, ошибках и действиях пользователей для аудита, поиска проблем и безопасности.|

---

**Все компоненты и модули системы работают вместе, чтобы обеспечить надёжный, быстрый и безопасный анализ клиентских разговоров, автоматическую генерацию бизнес-отчётов и удобную работу для операторов и аналитиков, а также прозрачность и контроль для руководства и службы безопасности.**

## Шаги развертывания приложения

### Системные требования

- **Операционная система:** Linux/macOS/Windows 10+
- **Python:** 3.11+
- **Docker:** 20.10+
- **Docker Compose:** 2.0+
- **RAM:** минимум 8GB, рекомендуется 16GB
- **Диск:** 10GB свободного места

### 1. Подготовка окружения

```bash
git clone https://github.com/LM8818/SF_Rep.git
cd SF_Rep/BankingNLP_v2

python -m venv .venv
source venv/bin/activate  # На Windows: venv\Scripts\activate

pip install -r requirements.txt
```

### 2. Настройка конфигурации

```bash
cp .env.template .env
nano .env
```

Пример .env файла:

```env
SECRET_KEY=your-secret-key-here
DATABASE_URL=postgresql://user:password@localhost:5432/bankingnlp
LOG_LEVEL=INFO
API_V1_STR=/api/v1
```

### 3. Локальный запуск (без Docker)

```bash
python run.py all
python run.py data      # Загрузка и очистка данных
python run.py features  # Генерация признаков
python run.py train     # Обучение модели
python run.py predict   # Инференс
python run.py eval      # Оценка качества
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### 4. Запуск через Docker Compose (рекомендуется)

```bash
python run.py .venv
docker-compose up --build -d
docker-compose ps
docker-compose logs -f web
docker-compose exec web python scripts/db_migration.py
```

### 5. Проверка работоспособности

После успешного запуска приложение будет доступно по следующим адресам:

- **Веб-интерфейс:** http://localhost:8080
- **API документация (Swagger):** http://localhost:8080/docs
- **ReDoc документация:** http://localhost:8080/redoc
- **Статус здоровья:** http://localhost:8080/health
- **Метрики (Prometheus):** http://localhost:8080/metrics

### 6. Запуск тестов

```bash
docker-compose exec web pytest
docker-compose exec web pytest --cov=app tests/
docker-compose exec web pytest tests/unit/
docker-compose exec web pytest tests/integration/
```

### 7. Развертывание в продакшене

```bash
kubectl apply -f infrastructure/k8s/
kubectl get pods -n bankingnlp --watch
kubectl logs -f deployment/bankingnlp-web -n bankingnlp
```

## Работа с пользовательскими формами (User Guide)

Ниже приведена инструкция по запуску и использованию веб-интерфейса для тестирования и анализа.

### 1. Запуск веб-сервера

Убедитесь, что ваше виртуальное окружение активировано (`source .venv/bin/activate`). Затем запустите сервер из корневой папки проекта:

```bash
# --reload автоматически перезапускает сервер при изменениях в коде
uvicorn app.main:app --reload
```

После успешного запуска сервер будет доступен по адресу `http://127.0.0.1:8000`.

### 2. Открытие страницы тестирования

Основная страница для всех тестов находится по адресу:
**[http://127.0.0.1:8000/test](http://127.0.0.1:8000/test)**

На этой странице доступны три вкладки:
-   Анализ одного разговора
-   Пакетный анализ (нескольких разговоров)
-   Бенчмарк (тест производительности)

### 3. Анализ одного разговора

Это основная форма для быстрой проверки.

-   **Текст разговора**: Вставьте сюда текст для анализа.
-   **Модель LLM**: Выберите одну из доступных локальных моделей (например, `llama3.1:8b`). Эти модели должны быть предварительно загружены в вашем Ollama-сервере.
-   **Кнопка "Анализировать"**: Запускает процесс. Результат появится в блоке справа.

### 4. Пакетный анализ

Позволяет анализировать несколько текстов за один раз.

-   Используйте кнопку **"Добавить разговор"**, чтобы создать поля для нескольких текстов.
-   Нажмите **"Начать пакетный анализ"**, чтобы обработать все тексты. Результаты появятся ниже.

### 5. Бенчмарк

Этот раздел предназначен для тестирования производительности системы.

-   **Количество записей**: Укажите, сколько синтетических записей нужно сгенерировать и обработать.
-   **Кнопка "Запустить тест"**: Запускает бенчмарк. Результаты (скорость, время, использование памяти) отобразятся под кнопкой.

### 6. Страницы "Аналитика" и "Дашборд"

Ссылки на эти страницы находятся в навигационной панели слева.

-   **Изначально они пустые**: Пока вы не проанализировали ни одного разговора, на этих страницах будут отображаться заглушки.
-   **Наполнение данными**: После того как вы проанализируете тексты через формы, данные на страницах аналитики и дашборда начнут появляться.

_**(Этот раздел можно дополнить скриншотами и более подробными инструкциями по мере развития интерфейса.)**_



