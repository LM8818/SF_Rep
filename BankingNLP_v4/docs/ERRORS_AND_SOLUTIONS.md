# Частые ошибки и их решения (BankingNLP_v2)

---

## Ошибка: Address already in use

**Сообщение:**
```
ERROR:    [Errno 48] Address already in use
```

**Причина:**
Порт (по умолчанию 8000 для uvicorn), на котором запускается сервер, уже занят другим процессом.

### Как исправить

**Вариант 1: Остановить процесс, который занимает порт**
1. Найдите процесс, который использует порт 8000:
   ```bash
   lsof -i :8000
   ```
2. В выводе будет PID (номер процесса). Остановите его:
   ```bash
   kill -9 <PID>
   ```
   (где `<PID>` — номер процесса из предыдущей команды)

**Вариант 2: Запустить uvicorn на другом порту**
```bash
uvicorn app.main:app --reload --port 8001
```
или любой другой свободный порт.

**Вариант 3: Если используете docker-compose**
- Убедитесь, что контейнеры не запущены дважды:
  ```bash
  docker-compose ps
  docker-compose down
  ```

---

## Ошибка: Страница не найдена (404 Not Found)

**Сообщение:**
```
Страница не найдена
404 Not Found
```

**Возможные причины:**
- Открыт неправильный адрес (URL) или порт в браузере.
- Сервер backend не запущен или запущен с ошибкой.
- В FastAPI отсутствует маршрут (роут) для этого пути.
- Не найден соответствующий HTML-шаблон или static-файл.
- Frontend (если отдельный) не запущен или не обслуживает этот путь.

### Как проверить и устранить

1. **Проверьте адрес в браузере**
   - Убедитесь, что открываете правильный путь, например:
     - http://localhost:8000/dashboard
     - http://localhost:8000/analytics
   - Проверьте, что порт совпадает с тем, на котором запущен сервер.

2. **Проверьте, что сервер запущен**
   - В терминале не должно быть ошибок, сервер должен быть в состоянии "Running".
   - Если сервер был перезапущен, убедитесь, что он стартовал без ошибок.

3. **Проверьте наличие роутов/шаблонов**
   - В FastAPI должны быть определены соответствующие маршруты для `/dashboard` или `/analytics`.
   - Проверьте, что в файле `app/main.py` или соответствующем роутере есть обработчик для этого пути.

4. **Проверьте frontend**
   - Если используется отдельный frontend (React/Vue), убедитесь, что он запущен и доступен по нужному адресу/порту.
   - Если frontend обслуживается FastAPI через шаблоны, убедитесь, что шаблон (например, `dashboard.html`) существует в папке `templates/`.

5. **Проверьте логи сервера**
   - В терминале с backend посмотрите, есть ли сообщения об ошибках при попытке открыть страницу.
   - Если есть Traceback или 404 — изучите их для диагностики.

6. **Проверьте static и templates**
   - Убедитесь, что папка `frontend/templates/` содержит нужный HTML-файл.
   - Проверьте, что в FastAPI правильно настроен путь к шаблонам и static-файлам.

7. **(Опционально) Уточните детали**
   - Сообщите, какой адрес вы открываете в браузере.
   - Приложите вывод из терминала при попытке открыть страницу (логи сервера).
   - Уточните, как у вас устроен frontend: отдельный сервер или через FastAPI.

**Если после всех проверок проблема не решена — обратитесь к разработчику или опишите ситуацию в чате поддержки проекта.**

---

## Ошибка: Формы отображаются не единообразно/неэргономично

**Сообщение/симптомы:**
- Формы на разных страницах выглядят по-разному, не соответствуют единому стилю.
- Элементы управления расположены неэкономично, интерфейс перегружен или неудобен для пользователя.
- После изменений шаблонов старый вид форм может сохраняться до перезапуска сервера.

**Причины:**
- Используются разные шаблоны или CSS-стили для разных форм.
- Нет единого подхода к верстке и UX.
- Не согласованы отступы, размеры, расположение кнопок и полей.

**Диагностика:**
- Визуально сравните формы на разных страницах.
- Используйте скриншоты (например, docs/img/API_test_req.jpg и docs/img/API_test_ans.jpg) для сравнения с эталонным UX.
- Проверьте, что все формы используют общий базовый шаблон (base.html) и единые CSS-классы.

**Как исправить:**
1. Унифицируйте стиль всех форм:
   - Используйте общий базовый шаблон (base.html) для всех страниц.
   - Применяйте одни и те же CSS-классы для одинаковых элементов (input, button, label и т.д.).
   - Согласуйте отступы, размеры, расположение элементов.
2. Сделайте формы более эргономичными:
   - Размещайте элементы компактно, избегайте лишних пустых областей.
   - Кнопки и поля должны быть легко доступны и логично сгруппированы.
   - Результаты отображайте сразу под формой, как на скриншотах API_test_req и API_test_ans.
3. После внесения изменений обязательно перезапустите сервер, чтобы шаблоны обновились.

**Примечание:**
- После каждого изменения шаблонов или статики (CSS/JS) перезапускайте сервер, чтобы увидеть актуальные изменения.

---

## Ошибка: AttributeError: 'Settings' object has no attribute 'api_auth_enabled'

**Описание:**

При добавлении рубильника для отключения авторизации API (например, для отладки) возникает ошибка:

```
AttributeError: 'Settings' object has no attribute 'api_auth_enabled'
```

**Причина:**

В проекте используются разные классы/объекты для конфигурации. Если вы добавили флаг `api_auth_enabled` в свой класс `Config`, но в коде используется объект `settings` (например, из pydantic или другого файла), то у него этого атрибута нет.

**Решение:**

1. Убедитесь, что флаг `api_auth_enabled` добавлен именно в тот класс/объект, который импортируется как `settings` в файле с эндпоинтами.
2. Если используется pydantic Settings, добавьте флаг в соответствующий класс и/или в `.env`/yaml.
3. Проверьте, что импортируете и используете один и тот же объект конфигурации во всех файлах.

**Пример для FastAPI:**

- В `app/core/config/config.py`:
  ```python
  class Settings(BaseSettings):
      ...
      api_auth_enabled: bool = True
  settings = Settings()
  ```
- В эндпоинтах:
  ```python
  from app.core.config import settings
  ...
  token: str = Depends(JWTBearer()) if settings.api_auth_enabled else None
  ```

**Важно:**
- После добавления нового поля в pydantic Settings, перезапустите сервер.
- Для временного отключения авторизации на всех NLP-эндпоинтах используйте флаг `api_auth_enabled: False` в конфиге.

---

## Ошибка: `No matching distribution found for sqlite3`

**Сообщение:**
```
ERROR: Could not find a version that satisfies the requirement sqlite3 (from versions: none)
ERROR: No matching distribution found for sqlite3
```
Или вы видите, что в путях установки используется не та версия Python (например, `python3.13` вместо `python3.12`).

**Причина:**
1.  **`sqlite3` в `requirements.txt`**: `sqlite3` — это стандартная библиотека Python, её не нужно устанавливать через `pip`.
2.  **Неверная версия Python в окружении**: Ваше виртуальное окружение (`.venv`) было создано с версией Python, которая не соответствует требованиям проекта (например, с системным Python 3.13 вместо требуемого 3.12).

### Как исправить

**Шаг 1: Исправить `requirements.txt`**
- Убедитесь, что в файле `requirements.txt` нет строки `sqlite3`.

**Шаг 2: Пересоздать виртуальное окружение**
1.  Деактивируйте текущее окружение:
    ```bash
    deactivate
    ```
2.  Удалите папку со старым окружением:
    ```bash
    rm -rf .venv
    ```
3.  Создайте окружение с правильной версией Python (например, 3.12):
    ```bash
    python3.12 -m venv .venv
    ```
    *(Если нужная версия не установлена, используйте `brew install python@3.12` на macOS)*
4.  Активируйте новое окружение:
    ```bash
    source .venv/bin/activate
    ```
5.  Установите зависимости заново:
    ```bash
    pip install -r requirements.txt
    ```
После этого все зависимости установятся для правильной версии Python.

---

## [Добавляйте сюда другие ошибки и их решения по мере необходимости] 