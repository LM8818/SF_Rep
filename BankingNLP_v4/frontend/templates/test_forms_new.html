<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banking NLP System</title>
    <link rel="stylesheet" href="/static/css/test-form.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üè¶</div>
            <h1>Banking NLP System</h1>
            <p class="subtitle">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤</p>
        </div>

        <div class="form-section">
            <form id="analysis-form">
                <div class="form-group">
                    <label for="conversation-text">–¢–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞</label>
                    <textarea 
                        id="conversation-text" 
                        name="text" 
                        placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞..." 
                        required
                    ></textarea>
                </div>

                <div class="examples-section">
                    <p class="examples-title">–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</p>
                    <div class="example-buttons">
                        <button type="button" class="example-btn" data-example="–∫—Ä–µ–¥–∏—Ç">üöó –ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç</button>
                        <button type="button" class="example-btn" data-example="–ø—Ä–æ–±–ª–µ–º–∞">üì± –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º</button>
                        <button type="button" class="example-btn" data-example="–∏–ø–æ—Ç–µ–∫–∞">üè† –ò–ø–æ—Ç–µ–∫–∞</button>
                        <button type="button" class="example-btn" data-example="–∫–∞—Ä—Ç–∞">üí≥ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç—ã</button>
                        <button type="button" class="example-btn" data-example="–≤–∫–ª–∞–¥">üí∞ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –≤–∫–ª–∞–¥</button>
                    </div>
                </div>

                <button type="submit" class="analyze-btn" id="analyze-btn">
                    –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä
                </button>
            </form>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ -->
        <div class="results-section" id="results-section" style="display: none;">
            <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h2>
            
            <div class="result-grid">
                <div class="result-card">
                    <h3>üéØ –¢–µ–º–∞—Ç–∏–∫–∏</h3>
                    <div id="themes-container" class="tags-container"></div>
                </div>

                <div class="result-card">
                    <h3>üè¶ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã</h3>
                    <div id="products-container" class="tags-container"></div>
                </div>

                <div class="result-card">
                    <h3>üòä –≠–º–æ—Ü–∏–∏</h3>
                    <div id="emotions-container" class="emotions-chart"></div>
                </div>

                <div class="result-card">
                    <h3>üìä –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å</h3>
                    <div class="confidence-container">
                        <div class="confidence-bar-container">
                            <div class="confidence-bar" id="confidence-bar"></div>
                        </div>
                        <span class="confidence-value" id="confidence-value">0%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('analysis-form');
            const resultsSection = document.getElementById('results-section');
            const textArea = document.getElementById('conversation-text');
            const exampleButtons = document.querySelectorAll('.example-btn');
            
            // –ü—Ä–∏–º–µ—Ä—ã —Ç–µ–∫—Å—Ç–æ–≤
            const examples = {
                '–∫—Ä–µ–¥–∏—Ç': '–ö–ª–∏–µ–Ω—Ç: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —Ö–æ—á—É –æ—Ñ–æ—Ä–º–∏—Ç—å –∫—Ä–µ–¥–∏—Ç –Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—å. –ö–∞–∫–∏–µ —É –≤–∞—Å —É—Å–ª–æ–≤–∏—è?\n–û–ø–µ—Ä–∞—Ç–æ—Ä: –ö–æ–Ω–µ—á–Ω–æ! –†–∞—Å—Å–∫–∞–∂—É –æ –Ω–∞—à–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö –∞–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∏—è.',
                '–ø—Ä–æ–±–ª–µ–º–∞': '–ö–ª–∏–µ–Ω—Ç: –ù–µ –º–æ–≥—É –≤–æ–π—Ç–∏ –≤ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É.\n–û–ø–µ—Ä–∞—Ç–æ—Ä: –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º—Å—è —Å –ø—Ä–æ–±–ª–µ–º–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é.',
                '–∏–ø–æ—Ç–µ–∫–∞': '–ö–ª–∏–µ–Ω—Ç: –ò–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –∏–ø–æ—Ç–µ–∫–∞ –Ω–∞ –≤—Ç–æ—Ä–∏—á–Ω–æ–µ –∂–∏–ª—å–µ. –ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω—É–∂–Ω—ã?\n–û–ø–µ—Ä–∞—Ç–æ—Ä: –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä! –†–∞—Å—Å–∫–∞–∂—É –æ –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö –∏–ø–æ—Ç–µ—á–Ω–æ–≥–æ –∫—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∏—è.',
                '–∫–∞—Ä—Ç–∞': '–ö–ª–∏–µ–Ω—Ç: –ú–æ—è –∫–∞—Ä—Ç–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, –∫–∞–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å—á–µ—Ç—É?\n–û–ø–µ—Ä–∞—Ç–æ—Ä: –ü–æ–º–æ–∂–µ–º —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø.',
                '–≤–∫–ª–∞–¥': '–ö–ª–∏–µ–Ω—Ç: –•–æ—á—É –æ—Ç–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º. –ß—Ç–æ –ø–æ—Å–æ–≤–µ—Ç—É–µ—Ç–µ?\n–û–ø–µ—Ä–∞—Ç–æ—Ä: –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –Ω–∞—à–∏ –¥–µ–ø–æ–∑–∏—Ç–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Å –≤—ã–≥–æ–¥–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏.'
            };

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏–º–µ—Ä–æ–≤
            exampleButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const exampleType = this.dataset.example;
                    textArea.value = examples[exampleType];
                    
                    // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const text = textArea.value.trim();
                if (!text) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞');
                    return;
                }

                const analyzeBtn = document.getElementById('analyze-btn');
                const originalText = analyzeBtn.textContent;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
                analyzeBtn.textContent = '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º...';
                analyzeBtn.disabled = true;

                try {
                    const response = await fetch('/api/v1/nlp/analyze', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            text: text,
                            client_id: null,
                            channel: '—á–∞—Ç'
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    displayResults(data);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                    resultsSection.style.display = 'block';
                    resultsSection.scrollIntoView({ behavior: 'smooth' });

                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ:', error);
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Ç–µ–∫—Å—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                } finally {
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                    analyzeBtn.textContent = originalText;
                    analyzeBtn.disabled = false;
                }
            });

            function displayResults(data) {
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–º–∞—Ç–∏–∫
                const themesContainer = document.getElementById('themes-container');
                themesContainer.innerHTML = '';
                if (data.theme) {
                    const tag = document.createElement('span');
                    tag.className = 'tag';
                    tag.textContent = data.theme;
                    themesContainer.appendChild(tag);
                } else {
                    themesContainer.innerHTML = '<span class="tag">–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ</span>';
                }

                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
                const productsContainer = document.getElementById('products-container');
                productsContainer.innerHTML = '';
                if (data.products && data.products.length > 0) {
                    data.products.forEach(product => {
                        const tag = document.createElement('span');
                        tag.className = 'tag';
                        tag.textContent = product;
                        productsContainer.appendChild(tag);
                    });
                } else {
                    productsContainer.innerHTML = '<span class="tag">–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ</span>';
                }

                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–º–æ—Ü–∏–π
                const emotionsContainer = document.getElementById('emotions-container');
                emotionsContainer.innerHTML = '';
                if (data.emotion) {
                    const emotionItem = document.createElement('div');
                    emotionItem.className = 'emotion-item';
                    
                    const percentage = 85; // –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                    emotionItem.innerHTML = `
                        <span>${data.emotion}</span>
                        <div class="emotion-bar">
                            <div class="emotion-fill" style="width: ${percentage}%"></div>
                        </div>
                        <span>${percentage}%</span>
                    `;
                    emotionsContainer.appendChild(emotionItem);
                }

                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
                const confidenceBar = document.getElementById('confidence-bar');
                const confidenceValue = document.getElementById('confidence-value');
                
                if (data.confidence !== undefined) {
                    const confidence = Math.round(data.confidence * 100);
                    setTimeout(() => {
                        confidenceBar.style.width = `${confidence}%`;
                        confidenceValue.textContent = `${confidence}%`;
                    }, 300);
                } else {
                    // –ï—Å–ª–∏ confidence –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 75% –∫–∞–∫ –ø—Ä–∏–º–µ—Ä
                    setTimeout(() => {
                        confidenceBar.style.width = '75%';
                        confidenceValue.textContent = '75%';
                    }, 300);
                }
            }
        });
    </script>
</body>
</html> 